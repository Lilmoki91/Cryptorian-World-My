<!-- terminal-verification.html -->
<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ZORD TERMINAL IPFS</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


<style>
/* ========== OPENING UI STYLES ==========*/
#openingSplash {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #050805;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    transition: opacity 0.8s ease;
}

#splashImage {
    max-width: 300px;
    width: 80%;
    height: auto;
    border-radius: 15px;
    margin-bottom: 40px;
   /* box-shadow: 0 10px 30px rgba(0, 255, 102, 0.3);*/
}

.splash-loading-container {
    width: 80%;
    max-width: 400px;
    height: 12px;
    background: rgba(0, 50, 0, 0.3);
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid rgba(0, 255, 102, 0.2);
    margin-bottom: 20px;
}

#splashLoadingBar {
    width: 0%;
    height: 100%;
    background: linear-gradient(90deg, #003300, #00ff66, #88ffaa, #00ff66, #003300);
    border-radius: 6px;
    transition: width 0.3s ease;
}

#splashPercentage {
    color: #00ff66;
    font-family: 'JetBrains Mono', monospace;
    font-size: 18px;
    margin-bottom: 15px;
    font-weight: bold;
    text-shadow: 0 0 10px rgba(0, 255, 102, 0.5);
}

#splashStatus {
    color: #88ff88;
    font-family: 'JetBrains Mono', monospace;
    font-size: 14px;
    text-align: center;
    max-width: 400px;
    padding: 0 20px;
}

.splash-fallback {
    width: 300px;
    height: 200px;
    background: linear-gradient(135deg, #003300, #006600);
    border-radius: 15px;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #00ff66;
    font-size: 24px;
    font-weight: bold;
    font-family: 'JetBrains Mono', monospace;
    box-shadow: 0 10px 30px rgba(0, 255, 102, 0.2);
}


/* == FIX: HIDE BUTTONS DURING LOADING == */
body.splash-active .terminal-close-btn,
body.splash-active .terminal-back-btn,
body.splash-active #runBtn,
body.splash-active #consoleIcon,
body.splash-active .console-popup {
    display: none !important;
    opacity: 0 !important;
    visibility: hidden !important;
    pointer-events: none !important;
}

/* Pastikan splash screen cover semua */
#openingSplash {
    z-index: 10000 !important; /* Pastikan paling atas */
    background: #050805 !important; /* Solid background */
}

/* Kalau masih nampak, force hide dengan pseudo-element */
#openingSplash::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #050805;
    z-index: -1;
}


/* ==== KOD CSS ASAL ==== */
body {
  margin:0; padding:0; font-family:'JetBrains Mono', monospace;
  background:#050805; color:#00ff66; height:100vh; overflow:hidden;
  display: flex;
  flex-direction: column;
}

#terminal {
  padding: 0.5rem 20px;
  flex: 1;
  overflow-y: auto;
  overflow-x: auto;
  white-space: pre-wrap; 
  word-break: break-word;
  line-height: 1.5;
  background-color: rgba(0, 0, 0, 0.3);
  box-shadow: inset 0 0 30px rgba(0, 255, 102, 0.05);
  position: relative;
  z-index: 1;
  margin-bottom: 4.5rem; /*8.5rem;*/
  margin-top: 3.8rem;
  background: #222 !important;
}

/* TERMINAL OVERFLOW FIX */
#terminal::after {
  content: "‚ñç";
  display: inline;
  height: 80px;
  width: 100%;
 }

.cursor::after {
  content:"‚ñç"; 
  margin-left:2px;    
  animation:blink 1s infinite; 
  color:white;
}
@keyframes blink {0%,50%{opacity:1}51%,100%{opacity:0}}

#runBtn {
  position: fixed !important; 
  bottom: 20px !important; 
  right: 20px !important;
  padding: 12px 20px !important; 
  border-radius: 6px !important; 
  border: none !important;
  background:#00ff66 !important; 
  color:#000 !important; 
  font-family:'JetBrains Mono', monospace !important;
  font-weight:bold !important; 
  cursor:pointer !important; 
  z-index: 100 !important;
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.5s ease, transform 0.5s ease;
  pointer-events: none;
  font-size: 16px !important;
  box-shadow: 0 4px 10px rgba(0, 255, 102, 0.3) !important;
}

#runBtn.show {
  opacity: 1 !important;
  transform: translateY(0) !important;
  pointer-events: auto !important;
}

#runBtn:hover {
  background:#00dd55 !important;
  box-shadow: 0 6px 15px rgba(0, 255, 102, 0.5) !important;
}

iframe {
  width:100%; 
  height:100%; 
  border:none;
}

/* SCROLLBAR STYLING - TERMINAL */
#terminal::-webkit-scrollbar {
  width: 8px; /* Vertical scrollbar */
  height: 8px; /* Horizontal scrollbar */
}
#terminal::-webkit-scrollbar-track {
  background: rgba(0, 255, 102, 0.05);
  border-radius: 4px;
}
#terminal::-webkit-scrollbar-thumb {
  background: rgba(0, 255, 102, 0.3);
  border-radius: 4px;
  border: 2px solid rgba(0, 255, 102, 0.05);
}
#terminal::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 255, 102, 0.5);
}
#terminal::-webkit-scrollbar-corner {
  background: rgba(0, 0, 0, 0.3);
}

/* For Firefox */
#terminal {
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 255, 102, 0.3) rgba(0, 255, 102, 0.05);
}

/* CONSOLE ICON & POPUP - CONSOLE MUNCUL AWAL DI STEP 3 */
#consoleIcon {
  position: fixed;
  bottom: 90px;
  left: 41px;
  width: 50px;
  height: 50px;
  background: #0066ff;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  cursor: pointer;
  z-index: 99;
  box-shadow: 0 4px 15px rgba(0, 102, 255, 0.4);
  transition: all 0.3s ease;
  opacity: 0;
  transform: scale(0.8);
  display: none;
  margin-bottom: -5.5rem;

}

#consoleIcon.show {
  opacity: 1;
  transform: scale(1);
  display: flex;
}

#consoleIcon:hover {
  background: #0055dd;
  transform: scale(1.1);
}

#consoleIcon:hover::after {
  content: "Alpha Console >_";
  position: absolute;
  top: -23px;
  left: 71%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  color: white;
  padding: 5px 5px;
  border-radius: 40px;
  font-size: 9px;
  white-space: nowrap;
  z-index: 1000;
 }

#consoleIcon.download-mode {
  background: #00aa66;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.1); }
  100% { transform: scale(1); }
}

/* CONSOLE POPUP - AUTO SHOW DI STEP 3 */
.console-popup {
  position: fixed;
  bottom: 150px;
  left: 15px;
  width: 380px;
  max-height: 500px;
  background: rgba(5, 8, 5, 0.95);
  border: 2px solid #0066ff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0, 102, 255, 0.4);
  z-index: 98;
  display: none;
  flex-direction: column;
  overflow: hidden;
  backdrop-filter: blur(10px);
  transition: all 0.3s ease;
  margin-bottom: -3.3rem;
  
}

.console-popup.show {
  display: flex;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

.console-popup.minimized {
  height: 50px !important;
  max-height: 50px !important;
}

.console-header {
  background: linear-gradient(90deg, rgba(0, 102, 255, 0.2), rgba(0, 102, 255, 0.1));
  padding: 12px 15px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid rgba(0, 102, 255, 0.3);
  cursor: move;
  user-select: none;
}

.console-title {
  color: #00aaff;
  font-weight: bold;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.console-controls {
  display: flex;
  gap: 8px;
}

.console-btn {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.1);
  color: white !important;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  transition: all 0.2s;
}

.console-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

.console-content {
  padding: 15px;
  overflow-y: auto;
  overflow-x: hidden;
  max-height: 400px;
  font-size: 13px;
  color: #aaddff;
  white-space: normal;
  word-break: break-word;
  
  /* SCROLLBAR STYLING - CONSOLE CONTENT */
  scrollbar-width: thin; /* Firefox */
  scrollbar-color: rgba(0, 102, 255, 0.5) rgba(0, 102, 255, 0.1);
}

/* Webkit scrollbar styling for console content */
.console-content::-webkit-scrollbar {
  width: 4px; /* Vertical scrollbar width */
  height: 4px; /* Horizontal scrollbar height */
}

.console-content::-webkit-scrollbar-track {
  background: rgba(0, 102, 255, 0.1);
  border-radius: 4px;
}

.console-content::-webkit-scrollbar-thumb {
  background: #888;
  border-radius: 4px;
  border: 2px solid rgba(0, 102, 255, 0.1);
}

.console-content::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 102, 255, 0.7);
}

.console-content::-webkit-scrollbar-corner {
  background: rgba(5, 8, 5, 0.95);
}

/* Console content specific styles */
.console-line {
  margin-bottom: 8px;
  line-height: 1.4;
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
}

.console-line.command {
  color: #00ff66;
  font-weight: bold;
}

.console-line.output {
  color: #aaddff;
  padding-left: 15px;
}

.console-line.error {
  color: #ff6666;
  padding-left: 15px;
}

.console-line.success {
  color: #66ffaa;
  padding-left: 15px;
}

/* For long code or data that needs horizontal scrolling */
.console-code {
  background: rgba(0, 0, 0, 0.3);
  padding: 10px;
  border-radius: 6px;
  margin: 8px 0;
  overflow-x: auto;
  white-space: pre;
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  border-left: 3px solid #0066ff;
}

/* SCROLLABLE OPTIONS CONTAINER */
.console-options-container {
  max-height: 200px;
  overflow-y: auto;
  overflow-x: hidden;
  margin: 10px 0;
}

.verify-option, .download-option {
  margin: 10px 0;
  padding: 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  min-width: 100px; /* Ensure minimum width */
  word-break: break-word;
}

.verify-option {
  border: 1px solid rgba(0, 102, 255, 0.3);
  background: rgba(0, 102, 255, 0.05);
}

.verify-option:hover {
  background: rgba(0, 102, 255, 0.15);
  border-color: #0099ff;
  transform: translateY(-2px);
}

.download-option {
  border: 1px solid rgba(0, 170, 102, 0.3);
  background: rgba(0, 170, 102, 0.05);
}

.download-option:hover {
  background: rgba(0, 170, 102, 0.15);
  border-color: #00cc88;
  transform: translateY(-2px);
}

.option-active {
  box-shadow: 0 0 15px rgba(0, 170, 255, 0.3);
}

.cid-display {
  background: rgba(0, 50, 100, 0.3);
  padding: 10px;
  border-radius: 6px;
  border: 1px solid rgba(0, 170, 255, 0.3);
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  word-break: break-all;
  margin: 10px 0;
  color: #66ccff;
  overflow-x: auto;
  white-space: normal;
  max-height: 100px;
}

/* Custom scrollbar for cid-display */
.cid-display::-webkit-scrollbar {
  height: 6px;
}

.cid-display::-webkit-scrollbar-track {
  background: rgba(0, 102, 255, 0.05);
}

.cid-display::-webkit-scrollbar-thumb {
  background: rgba(0, 102, 255, 0.3);
}

/* SCROLLBAR FOR CONSOLE POPUP ITSELF (when content is too tall) */
.console-popup:not(.minimized) {
  overflow: hidden; /* Hide main popup scrollbar, use internal ones */
}

/* HORIZONTAL SCROLLING ENABLED FOR WIDE CONTENT */
.wide-content {
  min-width: 600px; /* Example for wide content */
  overflow-x: auto;
}

/* Responsive */
@media (max-width: 768px) {
  .console-popup {
    width: calc(100% - 40px);
    max-width: 350px;
    bottom: 130px;
    left: 20px;
  }
  
  #consoleIcon {
    bottom: 100px;
    left: 20px;
  }
  
  .console-content {
    padding: 10px;
  }
}

/* FORCE HORIZONTAL SCROLLBAR VISIBILITY */
.always-show-horizontal {
  overflow-x: scroll !important;
}

/* SMOOTH SCROLLING */
#terminal, .console-content, .cid-display {
  scroll-behavior: smooth;
}

/* CUSTOM SCROLLBAR STYLES FOR ALL SCROLLABLE ELEMENTS */
.scrollable {
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 102, 255, 0.5) rgba(0, 102, 255, 0.1);
}

.scrollable::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}

.scrollable::-webkit-scrollbar-track {
  background: rgba(0, 102, 255, 0.1);
}

.scrollable::-webkit-scrollbar-thumb {
  background: rgba(0, 102, 255, 0.5);
  border-radius: 4px;
}

.scrollable::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 102, 255, 0.7);
}


/* CLOSE BUTTON CSS - Copy dalam <style> atau file .css */
.terminal-close-btn {
    position: absolute;
    top: 10px;
    right: 25px;
    z-index: 9999;
    background: #ff4444;
    color: white;
    border: none;
    padding: 4px 15px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 16px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
    box-shadow: 0 4px 8px rgba(255, 0, 0, 0.3);
    height: 42px;
}

.terminal-close-btn:hover {
    background: #ff0000;
    transform: scale(1.05);
}

.terminal-close-btn:active {
    transform: scale(0.95);
}    

/*back button*/
.terminal-back-btn {
    position: fixed;
    top: 8px;
    left: 15px;
    z-index: 9998;
    background: #0066ff;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 50px;
    cursor: pointer;
    font-size: 16px;
    height: 42px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.3s;
}

.terminal-back-btn:hover {
    background: #0055dd;
    transform: translateX(-3px);
}
</style>

</head>
<body>
<!-- TERMINAL UTAMA -->
<div id="terminal" class="cursor"></div>

<!-- INJECT SELEPAS <body> TAG -->
<div id="openingSplash">
    <img src="https://raw.githubusercontent.com/Lilmoki91/Azura-Ai-Web-Search/refs/heads/main/ZORD-TERMINAL.webp" 
         alt="ZORD Terminal" 
         id="splashImage"
         onerror="this.style.display='none'; document.getElementById('fallbackLogo').style.display='flex';">
    
    <div id="fallbackLogo" class="splash-fallback" style="display: none;">
        ZORD TERMINAL
    </div>
    
    <div class="splash-loading-container">
        <div id="splashLoadingBar"></div>
    </div>
    
    <div id="splashPercentage">0%</div>
    <div id="splashStatus">Initializing Terminal System...</div>
</div>

<!-- Butang closed terminal -->
<button class="terminal-close-btn" onclick="window.location.href='index.html?menu=open'">
    <i class="fas fa-times"></i>
</button>  

<!-- back button -->
<button id="backBtn" class="terminal-back-btn" onclick="goBackStage()">
    <i class="fas fa-arrow-left"></i> Back
</button>

<!-- CONSOLE ICON - PAKAI ICON YANG ADA -->
<div id="consoleIcon">
  <i class="fas fa-terminal"></i> <!-- ICON TERMINAL YANG ADA -->
</div>

<!-- CONSOLE POPUP - AUTO SHOW DI STEP 3 -->
<div class="console-popup" id="consolePopup">
  <div class="console-header" id="consoleHeader">
    <div class="console-title">
      <i class="fas fa-terminal"></i>
      <span>ALPHA CONSOLE</span>
    </div>
    <div class="console-controls">
      <button class="console-btn" id="consoleMinimizeBtn" title="Minimize">
        <i class="fas fa-minus"></i>
      </button>
      <button class="console-btn" id="consoleCloseBtn" title="Close (Icon akan tetap ada)">
        <i class="fas fa-times"></i>
      </button>
    </div>
  </div>
  <div class="console-content" id="consoleContent">
    <!-- Content akan diisi oleh JavaScript -->
  </div>
</div>

<!-- BUTTON UTAMA -->
<button id="runBtn">‚ñ∂ Run Terminal</button>

<script>
/* INJECT DI AWAL <script> TAG, SEBELUM "VARIABLES GLOBAL" */
// ================================
// OPENING UI LOADING BAR SYSTEM
// ================================

function initSplashScreen() {
    // 1. HIDE SEMUA BUTTON SEMASA LOADING
    document.body.classList.add('splash-active');
    
    // Manual hide untuk pastikan
    const buttonsToHide = [
        '.terminal-close-btn',
        '.terminal-back-btn', 
        '#runBtn',
        '#consoleIcon',
        '.console-popup'
    ];
    
    buttonsToHide.forEach(selector => {
        const el = document.querySelector(selector);
        if (el) {
            el.style.cssText = `
                opacity: 0 !important;
                visibility: hidden !important;
                pointer-events: none !important;
            `;
        }
    });
    
    // 2. GET DOM ELEMENTS
    const splashScreen = document.getElementById('openingSplash');
    const loadingBar = document.getElementById('splashLoadingBar');
    const percentage = document.getElementById('splashPercentage');
    const statusText = document.getElementById('splashStatus');
    const splashImage = document.getElementById('splashImage');
    
    // 3. VARIABLE DECLARATION (INI YANG PERLU!)
    let progress = 0; // ‚Üê DEKLARASI DI SINI, BUKAN DALAM FUNCTION DALAMAN
    
    // 4. LOADING STEPS
    const steps = [
        { progress: 15, text: "Loading system assets..." },
        { progress: 30, text: "Initializing terminal interface..." },
        { progress: 50, text: "Setting up verification protocols..." },
        { progress: 70, text: "Establishing IPFS connection..." },
        { progress: 85, text: "Loading Alpha Console..." },
        { progress: 100, text: "System ready! Entering terminal..." }
    ];
    
    // 5. FUNCTION UNTUK SHOW BUTTONS BALIK
    function showAllButtons() {
        document.body.classList.remove('splash-active');
        
        buttonsToHide.forEach(selector => {
            const el = document.querySelector(selector);
            if (el) {
                el.style.cssText = '';
            }
        });
    }
    
    // 6. MAIN LOADING ANIMATION FUNCTION
    function updateSplash() {
        // Update loading bar width
        loadingBar.style.width = progress + '%';
        
        // Update percentage text
        percentage.textContent = Math.round(progress) + '%';
        
        // Update status text based on progress
        const currentStep = steps.find(step => progress <= step.progress);
        if (currentStep) {
            statusText.textContent = currentStep.text;
        }
        
        // Simulate realistic loading with random increments
        let increment = 1 + Math.random() * 3;
        
        // Occasionally "stall" to simulate processing
        if (progress > 40 && progress < 70 && Math.random() < 0.2) {
            increment = 0.5; // Slow down
        }
        
        // Fast progress at the end
        if (progress > 90) {
            increment = 2 + Math.random() * 4;
        }
        
        // Update progress
        progress += increment;
        
        // Continue or finish
        if (progress < 100) {
            // Continue loading
            setTimeout(updateSplash, 50 + Math.random() * 100);
        } else {
            // Loading complete - fade out sequence
            setTimeout(() => {
                // Start fade out
                splashScreen.style.opacity = '0';
                
                setTimeout(() => {
                    // Hide completely
                    splashScreen.style.display = 'none';
                    
                    // Show all buttons again
                    showAllButtons();
                    
                    // Start the terminal sequence
                    startTerminalSequence();
                    
                }, 800); // Wait for fade out to complete
                
            }, 500); // Wait a moment at 100%
        }
    }
    
    // 7. IMAGE ERROR HANDLING
    splashImage.onerror = function() {
        this.style.display = 'none';
        const fallback = document.getElementById('fallbackLogo');
        if (fallback) {
            fallback.style.display = 'flex';
        }
    };
    
    // 8. START THE LOADING ANIMATION
    setTimeout(() => {
        updateSplash();
    }, 500); // Small delay before starting
}

// ================================
// FUNCTION UNTUK START TERMINAL SETELAH LOADING
// ================================
function startTerminalSequence() {
    // Hide the main button initially
    hideButton();
    
    // Initialize console popup system
    initConsolePopup();
    
    // Update back button visibility
    updateBackButton();
    
    // Start the terminal with a small delay
    setTimeout(async () => {
        await showRunTerminal();
    }, 300);
}


// system typing terminal//
const terminalEl = document.getElementById('terminal');
const runBtn = document.getElementById('runBtn');
const consoleIcon = document.getElementById('consoleIcon');
const consolePopup = document.getElementById('consolePopup');
const consoleContent = document.getElementById('consoleContent');
const consoleMinimizeBtn = document.getElementById('consoleMinimizeBtn');
const consoleCloseBtn = document.getElementById('consoleCloseBtn');
const consoleHeader = document.getElementById('consoleHeader');

const CID = "";
const GATEWAY = `https://ipfs.io/ipfs/${CID}`;

let loadingInterval;
let typingActive = true;
let currentStep = 1;
let isDragging = false;
let dragOffset = { x: 0, y: 0 };
let isConsoleMinimized = false;

// ================================
// SOUND SYSTEM
// ================================
const sounds = [1,2,3,4].map(i => {
  const s = new Audio(`https://motionape-website.s3.us-east-1.amazonaws.com/Freebies/SoundFX/Sounds/Keyboard/Keyboard-0${i}.mp3`);
  s.volume = 0.12;
  return s;
});

// ================================
// CONSOLE POPUP SYSTEM - AUTO SHOW DI STEP 3
// ================================
function initConsolePopup() {
  // Toggle popup visibility - ICON KLIK UNTUK BUKA/TUTUP
  consoleIcon.addEventListener('click', toggleConsolePopup);
  
  // Minimize button
  consoleMinimizeBtn.addEventListener('click', () => {
    isConsoleMinimized = !isConsoleMinimized;
    if (isConsoleMinimized) {
      consolePopup.classList.add('minimized');
      consoleContent.style.display = 'none';
      consoleMinimizeBtn.innerHTML = '<i class="fas fa-plus"></i>';
      consoleMinimizeBtn.title = 'Maximize';
    } else {
      consolePopup.classList.remove('minimized');
      consoleContent.style.display = 'block';
      consoleMinimizeBtn.innerHTML = '<i class="fas fa-minus"></i>';
      consoleMinimizeBtn.title = 'Minimize';
    }
  });
  
  // Close button - HANYA TUTUP POPUP, ICON TETAP ADA
  consoleCloseBtn.addEventListener('click', () => {
    consolePopup.classList.remove('show');
  });
  
  // Draggable functionality
  consoleHeader.addEventListener('mousedown', startDrag);
  document.addEventListener('mousemove', drag);
  document.addEventListener('mouseup', stopDrag);
}

function toggleConsolePopup() {
  if (consolePopup.classList.contains('show')) {
    consolePopup.classList.remove('show');
  } else {
    showConsolePopup();
  }
}

function showConsolePopup() {
  consolePopup.classList.add('show');
  consolePopup.classList.remove('minimized');
  consoleContent.style.display = 'block';
  consoleMinimizeBtn.innerHTML = '<i class="fas fa-minus"></i>';
  consoleMinimizeBtn.title = 'Minimize';
  isConsoleMinimized = false;
  
  // Update content berdasarkan step saat ini
  updateConsoleContent();
}

function startDrag(e) {
  if (e.target.closest('.console-btn')) return;
  isDragging = true;
  const rect = consolePopup.getBoundingClientRect();
  dragOffset.x = e.clientX - rect.left;
  dragOffset.y = e.clientY - rect.top;
  consoleHeader.style.cursor = 'grabbing';
}

function drag(e) {
  if (!isDragging) return;
  e.preventDefault();
  consolePopup.style.left = (e.clientX - dragOffset.x) + 'px';
  consolePopup.style.top = (e.clientY - dragOffset.y) + 'px';
  consolePopup.style.right = 'auto';
  consolePopup.style.bottom = 'auto';
}

function stopDrag() {
  isDragging = false;
  consoleHeader.style.cursor = 'move';
}

function updateConsoleContent() {
  if (currentStep === 4) {
    // STEP 4: DOWNLOAD MODE
    consoleContent.innerHTML = `
      <div style="color: white; font-weight: bold; margin-bottom: 15px; font-size: 14px;">
        <i class="fas fa-download"></i> ALPHA CONSOLE - DOWNLOAD MODE
      </div>
      
      <div style="margin-bottom: 20px;">
        <div style="font-size: 12px; color: #66ccff; margin-bottom: 8px;">
          <i class="fas fa-key"></i> CID DATA TELAH DIAMBIL:
        </div>
        <div class="cid-display">
          ${CID}
        </div>
        <button onclick="copyCID()" style="
          margin-top: 10px; 
          padding: 8px 15px; 
          background: linear-gradient(90deg, #00aa66, #00cc88);
          border: none; 
          color: white; 
          border-radius: 6px; 
          cursor: pointer; 
          font-size: 13px;
          font-weight: bold;
          display: flex;
          align-items: center;
          gap: 8px;
          transition: all 0.3s;
        ">
          <i class="far fa-copy"></i> Copy CID
        </button>
      </div>
      
      <div style="font-size: 12px; color: #66ccff; margin-bottom: 12px;">
        <i class="fas fa-download"></i> DOWNLOAD OPTIONS:
      </div>
      
      <div class="download-option" onclick="downloadData('json')">
        <div style="display: flex; align-items: center; gap: 12px;">
          <i class="fas fa-file-code fa-lg" style="color: #00ff66;"></i>
          <div>
            <strong style="color: white;">Download JSON Metadata</strong>
            <div style="font-size: 11px; color: #88ffaa;">Format asli metadata IPFS</div>
          </div>
        </div>
      </div>
      
      <div class="download-option" onclick="downloadData('txt')">
        <div style="display: flex; align-items: center; gap: 12px;">
          <i class="fas fa-file-alt fa-lg" style="color: #00ff66;"></i>
          <div>
            <strong style="color: white;">Download Text Report</strong>
            <div style="font-size: 11px; color: #88ffaa;">Laporan verifikasi lengkap</div>
          </div>
        </div>
      </div>
      
      <div class="download-option" onclick="openInNewTab()">
        <div style="display: flex; align-items: center; gap: 12px;">
          <i class="fas fa-external-link-alt fa-lg" style="color: #00ff66;"></i>
          <div>
            <strong style="color: white;">Open in New Tab</strong>
            <div style="font-size: 11px; color: #88ffaa;">Buka data di tab baru</div>
          </div>
        </div>
      </div>
      
      <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(0, 255, 102, 0.3);">
        <div style="font-size: 11px; color: #88ffaa; line-height: 1.6;">
          <strong><i class="fas fa-check-circle"></i> Status:</strong> Data berjaya diambil dari IPFS!<br>
          ‚Ä¢ CID: <strong>${CID}</strong><br>
          ‚Ä¢ Gateway: <a href="${GATEWAY}" target="_blank" style="color: #7DD3FC;">${GATEWAY}</a><br>
          ‚Ä¢ Status: ‚úÖ Berjaya
        </div>
      </div>
    `;
  } else {
    // STEP 1-3: VERIFY MODE
    
consoleContent.innerHTML = `
  <div style="color: white; font-weight: bold; margin-bottom: 15px; font-size: 14px;">
    <i class="fas fa-search"></i> Manual verify
  </div>
  
  <div style="margin-bottom: 20px;">
    <div style="font-size: 12px; color: #66ccff; margin-bottom: 8px;">
      <i class="fas fa-key"></i> CID TO CHECK:
    </div>
    <div class="cid-display">
      ${CID}
    </div>
    <button onclick="copyCID()" style="
      margin-top: 10px; 
      padding: 8px 15px; 
      background: linear-gradient(90deg, #0066ff, #0099ff);
      border: none; 
      color: white; 
      border-radius: 6px; 
      cursor: pointer; 
      font-size: 13px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    ">
      <i class="far fa-copy"></i> Copy CID
    </button>
  </div>
  
  <!-- ================ QR CODE SECTION ================ -->
  <div style="margin: 25px 0; padding: 20px; background: rgba(5, 8, 5, 0.8); border-radius: 15px; border: 1px solid rgba(0, 102, 255, 0.3);">
    
    <!-- HEADER -->
    <div style="color: #00aaff; margin-bottom: 15px; font-size: 13px; font-weight: bold; display: flex; align-items: center; justify-content: center; gap: 10px;">
      <i class="fas fa-qrcode"></i>
      <span>IPFS QR CODE</span>
    </div>
    
    <!-- SCAN TEXT -->
    <div style="color: #66ccff; font-size: 12px; text-align: center; margin-bottom: 15px; padding: 8px; background: rgba(0, 102, 255, 0.1); border-radius: 8px;">
      <div style="display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 5px;">
        <i class="fas fa-mobile-alt"></i>
        <span><strong>SCAN QR CODE</strong></span>
      </div>
      <div>Untuk semak metadata platform Azura AI Web Search pada jaringan ipfs dunia</div>
    </div>
    
    <!-- QR IMAGE -->
    <div style="text-align: center; margin: 15px 0;"><img src="https://raw.githubusercontent.com/Lilmoki91/Azura-Ai-Web-Search/refs/heads/main/Azura%20Ai%20Qr%20code.png" 
     alt="Azura AI QR Code"
     style="
       width: 160px;
       height: 160px;
       border-radius: 10px;
       border: 2px solid #0066ff;
       padding: 10px;
       background: white;
       box-shadow: 0 5px 15px rgba(0, 102, 255, 0.3);
     "
     id="azuraQrImage">
    </div>
    
    <!-- SAVE BUTTON -->
    <div style="text-align: center; margin-top: 15px;">
      <button onclick="saveQRCode()"
              style="
                background: linear-gradient(90deg, #0066ff, #0099ff);
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 20px;
                cursor: pointer;
                font-size: 12px;
                font-weight: bold;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                transition: all 0.3s;
              "
              onmouseover="this.style.transform='translateY(-2px)'; this.style.background='linear-gradient(90deg, #0088ff, #00aaff)';"
              onmouseout="this.style.transform='translateY(0)'; this.style.background='linear-gradient(90deg, #0066ff, #0099ff)';">
        <i class="fas fa-download"></i>
        <span>SAVE QR CODE</span>
      </button>
    </div>
    
    <!-- INFO -->
    <div style="color: #88ccff; font-size: 10px; text-align: center; margin-top: 12px; line-height: 1.4;">
      <i class="fas fa-external-link-alt"></i>
      Laluan kepada: metadata jaringan ipfs dunia
    </div>
    
  </div>
  <!-- ================ END QR CODE ================ -->
  
  <div style="font-size: 12px; color: #66ccff; margin-bottom: 12px;">
    <i class="fas fa-tools"></i> SELECT VERIFICATION TOOL:
  </div>
  
  <div class="verify-option" onclick="openVerifyTool(1)">
    <div style="display: flex; align-items: center; gap: 12px;">
      <i class="fas fa-globe fa-lg" style="color: #00aaff;"></i>
      <div>
        <strong style="color: white;">IPFS Network Check</strong>
        <div style="font-size: 11px; color: #88ccff;">check.ipfs.network</div>
      </div>
    </div>
  </div>
  
  <div class="verify-option" onclick="openVerifyTool(2)">
    <div style="display: flex; align-items: center; gap: 12px;">
      <i class="fas fa-search fa-lg" style="color: #00aaff;"></i>
      <div>
        <strong style="color: white;">CID Inspector</strong>
        <div style="font-size: 11px; color: #88ccff;">cid.ipfs.io</div>
      </div>
    </div>
  </div>
  
  <div class="verify-option" onclick="openVerifyTool(3)">
    <div style="display: flex; align-items: center; gap: 12px;">
      <i class="fas fa-code fa-lg" style="color: #00aaff;"></i>
      <div>
        <strong style="color: white;">IPLD Explorer</strong>
        <div style="font-size: 11px; color: #88ccff;">explore.ipld.io</div>
      </div>
    </div>
  </div>
  
  <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(0, 102, 255, 0.3);">
    <div style="font-size: 11px; color: gold; line-height: 1.6;">
      <strong><i class="fas fa-info-circle"></i> Instructions:</strong><br>
      1. Pilih salah satu tool di atas<br>
      2. Tool akan terbuka di tab baru<br>
      3. Copy CID: <strong>${CID}</strong><br>
      4. Klik "Check" atau "Verify"<br>
      5. Semak butiran sumber tersebut
    </div>
  </div>
`;
  }
}

// TAMBAH FUNCTION saveQRCode() DI BAWAH
// FUNCTION saveQRCode()
function saveQRCode() {
    try {
        // Dapatkan button
        const btn = event.target.closest('button');
        if (!btn) return;
        
        // Simpan original
        const originalHTML = btn.innerHTML;
        
        // Loading state
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
        btn.disabled = true;
        
        // Buat download link
        const link = document.createElement('a');
        link.href = 'https://raw.githubusercontent.com/Lilmoki91/Azura-Ai-Web-Search/refs/heads/main/Azura%20Ai%20Qr%20code.png';
        link.download = 'Azura-AI-QR-Code.png';
        link.style.display = 'none';
        
        // Download
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        // Success
        setTimeout(() => {
            btn.innerHTML = '<i class="fas fa-check"></i> Saved!';
            
            // Kembali asal
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.disabled = false;
            }, 2000);
        }, 500);
        
    } catch (error) {
        console.log('Save error:', error);
        
        // Fallback: buka di tab baru
        window.open('https://raw.githubusercontent.com/Lilmoki91/Azura-Ai-Web-Search/refs/heads/main/Azura%20Ai%20Qr%20code.png', '_blank');
    }
}

function copyCID() {
  navigator.clipboard.writeText(CID).then(() => {
    const copyBtn = consoleContent.querySelector('button[onclick="copyCID()"]');
    if (copyBtn) {
      const originalHTML = copyBtn.innerHTML;
      copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
      
      if (currentStep === 4) {
        copyBtn.style.background = 'linear-gradient(90deg, #00cc88, #00eeaa)';
      } else {
        copyBtn.style.background = 'linear-gradient(90deg, #0099ff, #00bbff)';
      }
      
      setTimeout(() => {
        copyBtn.innerHTML = originalHTML;
        if (currentStep === 4) {
          copyBtn.style.background = 'linear-gradient(90deg, #00aa66, #00cc88)';
        } else {
          copyBtn.style.background = 'linear-gradient(90deg, #0066ff, #0099ff)';
        }
      }, 2000);
    }
  });
}

function openVerifyTool(toolNum) {
  const tools = [
    `https://check.ipfs.network/#${CID}`,
    `https://ipfs.io/ipfs/bafkreiaqqve4f4af6tqb7q4b7e7hk4fox4qzce7uqsq65kefmich7jd6hi`,
    `https://explore.ipld.io/#/explore/${CID}`
  ];
  
  const options = consoleContent.querySelectorAll('.verify-option');
  options.forEach(opt => opt.classList.remove('option-active'));
  options[toolNum - 1].classList.add('option-active');
  
  window.open(tools[toolNum - 1], '_blank');
}

function downloadData(type) {
  let content, filename, mimeType;
  
  if (type === 'json') {
    content = JSON.stringify({
      cid: CID,
      gateway: GATEWAY,
      verified: true,
      timestamp: new Date().toISOString(),
      platform: "AI Education Platform",
      metadata_source: "IPFS Network",
      status: "success"
    }, null, 2);
    filename = `ipfs-metadata-${CID.substring(0, 10)}.json`;
    mimeType = 'application/json';
  } else {
    content = `IPFS VERIFICATION REPORT
=============================
CID: ${CID}
Gateway: ${GATEWAY}
Status: Berjaya diambil dari IPFS
Timestamp: ${new Date().toLocaleString()}
Platform: AI Education Platform
Verification: Manual & Auto Verify
=============================
Metadata tersedia di: ${GATEWAY}
Untuk verify manual: https://check.ipfs.network/#${CID}`;
    filename = `verification-report-${CID.substring(0, 10)}.txt`;
    mimeType = 'text/plain';
  }
  
  const blob = new Blob([content], { type: mimeType });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function openInNewTab() {
  window.open(GATEWAY, '_blank');
}

// ================================
// TERMINAL FUNCTIONS
// ================================
function typeEffect(el, text, speed=5) {
  return new Promise(resolve=>{
    let i=0;
    const type = ()=>{
      el.textContent += text.charAt(i);
      if(i%3===0){
        const s = sounds[Math.floor(Math.random()*sounds.length)];
        s.currentTime=0; s.play().catch(()=>{});
      }
      i++;
      if (typingActive) el.scrollTop = el.scrollHeight;
      if(i<text.length) setTimeout(type, speed + Math.random()*5);
      else resolve();
    };
    type();
  });
}

function showButton() {
  setTimeout(() => {
    runBtn.classList.add('show');
    runBtn.style.pointerEvents = 'auto';
  }, 100);
}

function hideButton() {
  runBtn.classList.remove('show');
  runBtn.style.pointerEvents = 'none';
}

// 1. FUNCTION updateButton() - TUKAR BARIS 4 SAHAJA
function updateButton() {
  switch(currentStep) {
    case 1:
      runBtn.textContent = "‚ñ∂ Run Terminal";
      break;
    case 2:
      runBtn.textContent = "‚ñ∂ Approve";
      break;
    case 3:
      runBtn.textContent = "‚ñ∂ Auto Verify";
      break;
    case 4:
      runBtn.textContent = "‚úÖ Success"; // ‚Üê INI SAHAJA YANG TUKAR
      break;
  }
}

function loadingDots(msg, duration=3500) {
  return new Promise(resolve=>{
    let d=0;
    clearInterval(loadingInterval);
    loadingInterval = setInterval(()=>{
      terminalEl.textContent = `${msg}${'.'.repeat(d%5)}`;
      d++;
      terminalEl.scrollTop = terminalEl.scrollHeight;
    },400);
    setTimeout(()=>{
      clearInterval(loadingInterval);
      terminalEl.textContent = msg + "\n";
      resolve();
    }, duration);
  });
}

// ================================
// STEP FUNCTIONS
// ================================
async function showRunTerminal() {
  terminalEl.textContent = '';
  typingActive = true;
  
  const msg = `\n   ==========================
   ||                      ||
   ||‚Ä¢ ZORD TERMINAL V1.0 ‚Ä¢||
   || IPFS VERIFY PROTOCOL ||           
   ||                      ||
   ==========================
--------------------------------
>_ Alpha Console responding...

IPFS Node           : ACTIVE ‚úÖ
Verification Layer  : ENABLED ‚úÖ
--------------------------------
Welcome.üéâ
\n`;

  await typeEffect(terminalEl, msg, 5);

  const loadingMsg = `\n==> ‚ñ∂Ô∏è 'Run Terminal' to proceed`;
  terminalEl.textContent += loadingMsg;
  
  setTimeout(() => {
    terminalEl.scrollTop = terminalEl.scrollHeight;
  }, 100);

  typingActive = false;
  
  // HIDE CONSOLE ICON PADA STEP 1
  consoleIcon.classList.remove('show');
  consoleIcon.classList.remove('download-mode');
  consolePopup.classList.remove('show');
  
  let d = 0;
  clearInterval(loadingInterval);
  const fullText = terminalEl.textContent;
  
  loadingInterval = setInterval(() => {
    terminalEl.textContent = fullText + '.'.repeat(d % 4);
    d++;
  }, 400);
  
  currentStep = 1;
  updateButton();
  updateBackButton();
  showButton();
}

async function showVerify() {
  terminalEl.textContent = '';
  typingActive = true;
  
  const msg = `________________________________

>_ ("Integrity & Auditability platform verify system");
________________________________

 üìå Halaman ini disediakan untuk tujuan ketelusan, integriti, dan rujukan teknikal bagi platform dan model AI ini.

--------------------------------
 üìå Ia membolehkan pengguna menyemak maklumat asas berkaitan pembinaan, konfigurasi, dan rekod metadata sistem.

--------------------------------
 üìå Platform ini merupakan projek it pendidikan dan eksperimen teknologi AI, dibangunkan secara persendirian dan tanpa afiliasi dengan mana-mana institusi rasmi.

################################
`;

  await typeEffect(terminalEl, msg, 5);

  const loadingMsg = `\n==> ‚ñ∂Ô∏è Klik butang 'Approve'`;
  terminalEl.textContent += loadingMsg;
  
  setTimeout(() => {
    terminalEl.scrollTop = terminalEl.scrollHeight;
  }, 100);

  typingActive = false;
  
  // HIDE CONSOLE ICON DI STEP 2
  consoleIcon.classList.remove('show');
  consoleIcon.classList.remove('download-mode');
  consolePopup.classList.remove('show');
  
  let d = 0;
  clearInterval(loadingInterval);
  const fullText = terminalEl.textContent;
  
  loadingInterval = setInterval(() => {
    terminalEl.textContent = fullText + '.'.repeat(d % 4);
    d++;
  }, 400);
  
  currentStep = 2;
  updateButton();
  updateBackButton();
  showButton();
}

async function showApprove() {
  terminalEl.textContent = '';
  typingActive = true;
  
  const msg = `\n‚ö†Ô∏è "Rekod yang tersedia adalah metadata teknikal untuk rujukan audit dan integriti versi, metadata ini versi format json, sah tersimpan di jaringan node ipfs dunia."\n\n--------------------------------\n‚ÑπÔ∏è "Auto Verify :: Pengesahan automatik kebolehcapaian metadata CID melalui rangkaian IPFS dunia."\n\n--------------------------------\n‚ÑπÔ∏è "Manual Verify :: Semak CID pada Alpha Console secara manual melalui rangkaian IPFS dunia."\n\n--------------------------------\n`;

  await typeEffect(terminalEl, msg, 5);

  const urlsText = `üîó Laluan Gateway:\n${GATEWAY}\n\n
 üîê Cid key:\n${CID}\n\n
 üîé Sila scan Qr code pada Alpha Console\n\n
 üåê Sila "manual verify"Cid key pada link ipfs dunia dalam Alpha Console:\nhttps://check.ipfs.network/\n\n
‚ÑπÔ∏è Atau klik butang 'Auto Verify' dibawah ‚¨áÔ∏è\n\n################################\n`;
  await typeEffect(terminalEl, urlsText, 5);

  const loadingMsg = `\n==> ‚ñ∂Ô∏è Klik butang 
'Auto Verify'`;
  await typeEffect(terminalEl, loadingMsg, 5);
  
  setTimeout(() => {
    terminalEl.scrollTop = terminalEl.scrollHeight;
  }, 100);

  typingActive = false;
  
  // STEP 3: SHOW CONSOLE ICON & POPUP AUTOMATICALLY
  consoleIcon.classList.add('show');
  consoleIcon.classList.remove('download-mode');
  consoleIcon.innerHTML = '<i class="fas fa-terminal"></i>';
  
  // AUTO SHOW CONSOLE POPUP
  setTimeout(() => {
    showConsolePopup();
  }, 500);
  
  let d = 0;
  clearInterval(loadingInterval);
  const fullText = terminalEl.textContent;
  
  loadingInterval = setInterval(() => {
    terminalEl.textContent = fullText + '.'.repeat(d % 4);
    d++;
  }, 400);
  
  currentStep = 3;
  updateButton();
  updateBackButton();  
  showButton();
}

async function processVerification() {
  clearInterval(loadingInterval);
  hideButton();
  terminalEl.textContent = '';
  typingActive = true;

  // HIDE CONSOLE POPUP SAAT AUTO VERIFY DIKLIK
  consolePopup.classList.remove('show');
  
  await loadingDots(">_ Mengambil metadata webhook dari jaringan üåê Node IPFS dunia", 3000);
  
  const infoText = `
#################################

üì¶ ID Kandungan (CID): ${CID}
# ------------------------------

üîó Laluan Gateway: ${GATEWAY}
# ------------------------------

üìä Status: Berjaya mencapai rangkaian Node IPFS dunia üåê
# ------------------------------

`;
  
  await typeEffect(terminalEl, infoText, 15);

  await new Promise(resolve => {
    let dots = 0;
    const loadingText = "‚è≥ Tunggu sebentar";
    const interval = setInterval(() => {
      terminalEl.textContent += `\n${loadingText}${'.'.repeat(dots % 5)}`;
      terminalEl.scrollTop = terminalEl.scrollHeight;
      dots++;
    }, 400);
    
    setTimeout(() => {
      clearInterval(interval);
      terminalEl.textContent += "\n\n";
      resolve();
    }, 2000);
  });

  try {
    await loadingDots(">_ Muat turun sumber selesai. Metadata sumber sedia", 2000);
    
    // STEP 4: UPDATE CONSOLE ICON TO DOWNLOAD MODE
    consoleIcon.classList.add('show');
    consoleIcon.classList.add('download-mode');
    consoleIcon.innerHTML = '<i class="fas fa-terminal"></i>';
    
    // AUTO SHOW CONSOLE POPUP IN DOWNLOAD MODE
    setTimeout(() => {
      showConsolePopup();
    }, 1000);

    const iframe = document.createElement('iframe');
    iframe.src = GATEWAY;
    iframe.style.width = "100%";
    iframe.style.height = "calc(100vh - 40px)";
    iframe.style.border = "none";
    iframe.style.marginTop = "20px";
    iframe.title = "Aplikasi Web dari IPFS";

    terminalEl.innerHTML = "";
    terminalEl.appendChild(iframe);

  } catch(e) {
    await typeEffect(terminalEl, `\n‚ùå Ralat mengambil dari IPFS: ${e}\n`, 10);
    await typeEffect(terminalEl, `üîÑ Cuba semula dengan gateway alternatif...\n`, 15);
    
    const altGateway = `https://cloudflare-ipfs.com/ipfs/${CID}`;
    const iframe = document.createElement('iframe');
    iframe.src = altGateway;
    iframe.style.width = "100%";
    iframe.style.height = "calc(100vh - 40px)";
    iframe.style.border = "none";
    iframe.style.marginTop = "20px";
    terminalEl.appendChild(iframe);
  }
  
  currentStep = 4;
  updateButton();
  updateBackButton();
  showButton();
}

// ================================
// BACK BUTTON SYSTEM
// ================================
function updateBackButton() {
    const backBtn = document.getElementById('backBtn');
    if (!backBtn) return;
    
    // Sembunyikan jika typing aktif ATAU stage 1
    if (typingActive || currentStep === 1) {
        backBtn.style.display = 'none';
        backBtn.disabled = true;
    } else {
        backBtn.style.display = 'flex';
        backBtn.disabled = false;
    }
}

function goBackStage() {
    // Jangan boleh back kalau typing aktif
    if (typingActive) return;
    
    // Jangan boleh back dari stage 1
    if (currentStep <= 1) return;
    
    // Stop semua loading/typing
    clearInterval(loadingInterval);
    typingActive = false;
    hideButton();
    
    // Reset terminal
    terminalEl.textContent = '';
    
    // Pergi ke stage sebelumnya
    const previousStep = currentStep - 1;
    
    // Load stage berdasarkan previous step
    if (previousStep === 1) {
        // Load stage 1
        terminalEl.textContent = `\n   ==========================
   ||                      ||
   ||‚Ä¢ ZORD TERMINAL V1.0 ‚Ä¢||
   || IPFS VERIFY PROTOCOL ||           
   ||                      ||
   ==========================
--------------------------------
>_ Alpha Console responding...

IPFS Node           : ACTIVE ‚úÖ
Verification Layer  : ENABLED ‚úÖ
--------------------------------
Welcome.üéâ

==> ‚ñ∂Ô∏è 'Run Terminal' to proceed.`;
        currentStep = 1;
    }
    else if (previousStep === 2) {
        // Load stage 2
        terminalEl.textContent = `________________________________

>_ ("Integrity & Auditability platform verify system");
________________________________

 üìå Halaman ini disediakan untuk tujuan ketelusan, integriti, dan rujukan teknikal bagi platform dan model AI ini.

--------------------------------
 üìå Ia membolehkan pengguna menyemak maklumat asas berkaitan pembinaan, konfigurasi, dan rekod metadata sistem.

--------------------------------
 üìå Platform ini merupakan projek it pendidikan dan eksperimen teknologi AI, dibangunkan secara persendirian dan tanpa afiliasi dengan mana-mana institusi rasmi.

################################

==> ‚ñ∂Ô∏è Klik butang 'Approve'`;
        currentStep = 2;
    }
    else if (previousStep === 3) {
        // Load stage 3
        terminalEl.textContent = `\n‚ö†Ô∏è "Rekod yang tersedia adalah metadata teknikal untuk rujukan audit dan integriti versi, metadata ini versi format json sah tersimpan di jaringan node ipfs dunia."\n\n--------------------------------\n‚ÑπÔ∏è "Auto Verify :: Pengesahan automatik kebolehcapaian metadata CID melalui rangkaian IPFS dunia."\n\n--------------------------------\n‚ÑπÔ∏è "Manual Verify :: Semak CID pada Alpha Console secara manual melalui rangkaian IPFS dunia."\n\n--------------------------------\n

üîó Laluan Gateway:\n${GATEWAY}\n\n
 üîê Cid key:\n${CID}\n\n
 üåê Sila "manual verify" Cid key pada link ipfs dunia dalam Alpha Console:\nhttps://check.ipfs.network/\n\n
‚ÑπÔ∏è Atau klik butang 'Auto Verify' dibawah ‚¨áÔ∏è\n\n################################\n

==> ‚ñ∂Ô∏è Klik butang 
'Auto Verify'`;
        currentStep = 3;
    }
    
    // Update UI
    updateButton();
    updateBackButton();
    showButton();
    
    // Reset console jika ada
    consoleIcon.classList.remove('show');
    consolePopup.classList.remove('show');
}

// ================================
// INITIALIZE
// ================================
window.addEventListener('DOMContentLoaded', async () => {
    // Start with opening UI first
    initSplashScreen();
    // Terminal sequence will start automatically after splash screen finishes
    // through the startTerminalSequence() function
});

// EVENT LISTENER runBtn - TAMBAH CASE UNTUK STEP 4
runBtn.addEventListener('click', async () => {
  hideButton();
  clearInterval(loadingInterval);
  
  if (currentStep === 1) {
    await showVerify();
  } 
  else if (currentStep === 2) {
    await showApprove();
  }
  else if (currentStep === 3) {
    currentStep = 4;
    updateButton();
    setTimeout(async () => {
      await processVerification();
    }, 300);
  }
  else if (currentStep === 4) {
    // ‚Üê INI YANG PERLU TAMBAH
    // KEMBALI KE AZURA AI MENU
    runBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    runBtn.disabled = true;
    
    setTimeout(() => {
      window.location.href = 'index.html?menu=open';
    }, 500);
  }
});


// üìå SISTEM CLOSED TERMINAL - FINAL
function closeTerminal() {
    const btn = document.querySelector('.terminal-close-btn');
    
    if (btn) {
        // Spinner effect
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>closing...';
        btn.disabled = true;
        
        // Redirect dengan delay untuk spinner nampak
        setTimeout(() => {
            window.location.href = 'index.html?menu=open';
        }, 500);
    } else {
        // Direct jika button tak jumpa
        window.location.href = 'index.html?menu=open';
    }
}

// üìå INITIALIZE
document.addEventListener('DOMContentLoaded', function() {
    // Attach button
    const closeBtn = document.querySelector('.terminal-close-btn');
    if (closeBtn) {
        closeBtn.onclick = closeTerminal;
    }
    
    // Mobile back button handler
    if (/Android|iPhone|iPad/i.test(navigator.userAgent)) {
        history.pushState({ terminal: true }, '');
        window.addEventListener('popstate', function() {
            closeTerminal();
        });
    }
    
    // ESC key untuk desktop
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeTerminal();
        }
    });
});


//üìåüìåüìåüìåüìåüìåüìå
function goToAzuraMenu() {
    window.location.href = 'index.html?menu=open';
}

// ESC key
document.onkeydown = function(e) {
    if (e.key === 'Escape') goToAzuraMenu();
};

// Button
if (document.querySelector('.terminal-close-btn')) {
    document.querySelector('.terminal-close-btn').onclick = goToAzuraMenu;
}



</script>
</body>
</html>
